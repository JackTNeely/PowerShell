$Password = Read-Host "Enter a unique password to access certificates if recovery from backup is needed"; Get-ExchangeCertificate | ForEach-Object { $Thumbprint = $_.Thumbprint; $FilePath = "$env:userprofile\Desktop\Backups\Certificate-$Thumbprint.pfx"; $CertBytes = $_.Export("Pfx", $Password); [System.IO.File]::WriteAllBytes($FilePath, $CertBytes) }


$Password = Read-Host "Enter a password for the exported certificates" -AsSecureString; $Certificates = Get-ExchangeCertificate; ForEach ($Certificate in $Certificates) { $Thumbprint = $Certificate.Thumbprint; $FilePath = "$env:userprofile\Desktop\Backups\Certificates\$Thumbprint.pfx"; $Cert = New-Object System.Security.Cryptography.X509Certificates.X509Certificate2($Certificate.Certificate.Export([System.Security.Cryptography.X509Certificates.X509ContentType]::Pkcs12, $Password), $Password, [System.Security.Cryptography.X509Certificates.X509KeyStorageFlags]::Exportable); [System.IO.File]::WriteAllBytes($FilePath, $Cert.Export([System.Security.Cryptography.X509Certificates.X509ContentType]::Pkcs12, $Password)) }
